<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registro de Cargas</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div>
        <h1>Registro de Cargas</h1>
        <div class="sub">Foto ‚Üí Marcar √°rea ‚Üí OCR ‚Üí Producto + Foto ‚Üí WhatsApp</div>
      </div>
      <div class="status">
        <span id="dot" class="dot"></span>
        <span id="statusText">Listo.</span>
      </div>
    </header>

    <main class="grid">
      <section class="card">
        <div class="card-hd">
          <h2>Carga actual</h2>
          <div class="actions">
            <button id="btnNew" class="btn secondary">Nueva carga</button>
            <button id="btnClear" class="btn danger">Borrar historial</button>
          </div>
        </div>

        <div class="card-bd">
          <div class="row">
            <div>
              <label>Tracking (OCR o manual)</label>
              <input id="tracking" class="mono" placeholder="Ej: 4203316660949402108106245672088267" />
            </div>
            <div>
              <label>Fecha/Hora</label>
              <input id="date" class="mono" readonly />
            </div>
          </div>

          <div class="btns">
            <button id="btnTrackCam" class="btn">üì∏ Foto del tracking</button>
            <button id="btnTrackPick" class="btn secondary">üñºÔ∏è Elegir imagen</button>
            <button id="btnRotate" class="btn secondary" disabled>üîÑ Girar</button>
            <button id="btnRemoveTrackPhoto" class="btn secondary" disabled>üóëÔ∏è Quitar</button>
          </div>

          <div class="btns">
            <button id="btnOcrBox" class="btn secondary" disabled>‚úÖ OCR del recuadro</button>
            <button id="btnOcrAuto" class="btn secondary" disabled>‚ö° OCR autom√°tico</button>
          </div>

          <input id="trackCamInput" type="file" accept="image/*" capture="environment" hidden />
          <input id="trackPickInput" type="file" accept="image/*" hidden />

          <div id="scanWrap" class="scanWrap">
            <div class="scanTop">
              <div class="scanTitle">Selecciona el √°rea del TRACKING</div>
              <div class="scanHint">Arrastra en la imagen para dibujar el recuadro sobre el n√∫mero.</div>
            </div>

            <div class="scanCanvasWrap">
              <canvas id="scanCanvas"></canvas>
            </div>

            <div class="scanInfo">
              <div id="ocrProgress" class="small">Sube una foto para empezar.</div>
              <div id="ocrDebug" class="tiny">OCR: esperando‚Ä¶</div>
            </div>

            <div id="candWrap" class="cand">
              <div class="candTitle">Candidatos (toca el correcto):</div>
              <div id="candChips" class="chips"></div>
            </div>
          </div>

          <hr class="sep"/>

          <h3>Agregar producto (Informaci√≥n + Foto)</h3>

          <div class="row">
            <div>
              <label>Producto</label>
              <input id="product" placeholder="Ej: pares de zapatos Nike" />
            </div>
            <div>
              <label>Unidades</label>
              <input id="qty" type="number" min="1" step="1" placeholder="Ej: 3" />
            </div>
          </div>

          <div class="btns">
            <button id="btnProdCam" class="btn">üì∏ Foto producto</button>
            <button id="btnProdPick" class="btn secondary">üñºÔ∏è Subir foto</button>
            <button id="btnRemovePending" class="btn secondary" disabled>üóëÔ∏è Quitar foto</button>
          </div>

          <input id="prodCamInput" type="file" accept="image/*" capture="environment" hidden />
          <input id="prodPickInput" type="file" accept="image/*" hidden />

          <div id="pendingWrap" class="pending">
            <img id="pendingImg" alt="pendiente" />
            <div class="small">Foto lista ‚úÖ (se guardar√° al agregar)</div>
          </div>

          <div class="btns">
            <button id="btnAdd" class="btn">‚ûï Agregar a la carga</button>
          </div>

          <div class="totals">
            <div>
              <div class="big">Total unidades: <span id="totalUnits">0</span></div>
              <div class="small">Productos: <span id="totalItems">0</span></div>
            </div>
            <div class="btns" style="margin:0">
              <button id="btnWAImages" class="btn wa">üì≤ WhatsApp: enviar TODAS las fotos</button>
              <button id="btnWAText" class="btn wa">üì≤ WhatsApp: enviar texto</button>
            </div>
          </div>

          <div class="hint">
            <b>WhatsApp real (sin inventos):</b><br/>
            ‚Ä¢ ‚ÄúEnviar TODAS las fotos‚Äù intenta mandar todas juntas. Si tu tel√©fono no deja, las manda 1 por 1.<br/>
            ‚Ä¢ Luego ‚ÄúEnviar texto‚Äù manda el registro completo.
          </div>

          <hr class="sep"/>

          <h3>Lista (en orden)</h3>
          <div id="itemsList" class="items"></div>
        </div>
      </section>

      <section class="card">
        <div class="card-hd">
          <h2>Historial</h2>
          <button id="btnExport" class="btn secondary">Exportar JSON</button>
        </div>
        <div class="card-bd">
          <div id="historyList" class="history"></div>
          <div class="hint">Guardado local (localStorage).</div>
        </div>
      </section>
    </main>
  </div>

  <!-- OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
