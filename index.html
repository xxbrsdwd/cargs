<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registro de Cargas</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div>
        <h1>Registro de Cargas</h1>
        <div class="sub">Foto (tracking) â†’ OCR â†’ Producto + Foto â†’ WhatsApp</div>
      </div>
      <div class="status">
        <span id="dot" class="dot"></span>
        <span id="statusText">Listo.</span>
      </div>
    </header>

    <main class="grid">
      <section class="card">
        <div class="card-hd">
          <h2>Carga actual</h2>
          <div class="actions">
            <button id="btnNew" class="btn secondary">Nueva carga</button>
            <button id="btnClear" class="btn danger">Borrar historial</button>
          </div>
        </div>

        <div class="card-bd">
          <div class="row">
            <div>
              <label>Tracking (OCR o manual)</label>
              <input id="tracking" class="mono" placeholder="Ej: 4203316660949402108106245672088267" />
            </div>
            <div>
              <label>Fecha/Hora</label>
              <input id="date" class="mono" readonly />
            </div>
          </div>

          <div class="btns">
            <button id="btnTrackCam" class="btn">ğŸ“¸ Foto del tracking</button>
            <button id="btnTrackPick" class="btn secondary">ğŸ–¼ï¸ Elegir imagen</button>
            <button id="btnOcr" class="btn secondary" disabled>ğŸ” Re-OCR</button>
            <button id="btnRemoveTrackPhoto" class="btn secondary" disabled>ğŸ—‘ï¸ Quitar foto</button>
          </div>

          <input id="trackCamInput" type="file" accept="image/*" capture="environment" hidden />
          <input id="trackPickInput" type="file" accept="image/*" hidden />

          <div id="trackPreview" class="preview">
            <img id="trackImg" alt="preview" />
            <div class="previewText">
              <div class="strong">Foto cargada âœ…</div>
              <div id="ocrProgress" class="small">Lista para OCR.</div>
              <div id="ocrDebug" class="tiny">OCR: esperandoâ€¦</div>
            </div>
          </div>

          <div id="candWrap" class="cand">
            <div class="candTitle">Candidatos (toca el correcto):</div>
            <div id="candChips" class="chips"></div>
          </div>

          <hr class="sep"/>

          <h3>Agregar producto (InformaciÃ³n + Foto)</h3>

          <div class="row">
            <div>
              <label>Producto</label>
              <input id="product" placeholder="Ej: pares de zapatos Nike" />
            </div>
            <div>
              <label>Unidades</label>
              <input id="qty" type="number" min="1" step="1" placeholder="Ej: 3" />
            </div>
          </div>

          <div class="btns">
            <button id="btnProdCam" class="btn">ğŸ“¸ Foto producto</button>
            <button id="btnProdPick" class="btn secondary">ğŸ–¼ï¸ Subir foto</button>
            <button id="btnRemovePending" class="btn secondary" disabled>ğŸ—‘ï¸ Quitar foto</button>
          </div>

          <input id="prodCamInput" type="file" accept="image/*" capture="environment" hidden />
          <input id="prodPickInput" type="file" accept="image/*" hidden />

          <div id="pendingWrap" class="pending">
            <img id="pendingImg" alt="pendiente" />
            <div class="small">Foto lista âœ… (se guardarÃ¡ al agregar)</div>
          </div>

          <div class="btns">
            <button id="btnAdd" class="btn">â• Agregar a la carga</button>
          </div>

          <div class="totals">
            <div>
              <div class="big">Total unidades: <span id="totalUnits">0</span></div>
              <div class="small">Productos: <span id="totalItems">0</span></div>
            </div>
            <div class="btns" style="margin:0">
              <button id="btnWAImages" class="btn wa">ğŸ“² WhatsApp: enviar fotos</button>
              <button id="btnWAText" class="btn wa">ğŸ“² WhatsApp: enviar texto</button>
            </div>
          </div>

          <div class="hint">
            <b>Modo estable:</b><br/>
            1) â€œEnviar fotosâ€ abre el compartir para cada foto (elige WhatsApp y chat).<br/>
            2) Luego â€œEnviar textoâ€ abre WhatsApp con la informaciÃ³n completa.<br/>
            (WhatsApp no permite adjuntar fotos automÃ¡tico desde web).
          </div>

          <hr class="sep"/>

          <h3>Lista (en orden)</h3>
          <div id="itemsList" class="items"></div>
        </div>
      </section>

      <section class="card">
        <div class="card-hd">
          <h2>Historial</h2>
          <button id="btnExport" class="btn secondary">Exportar JSON</button>
        </div>
        <div class="card-bd">
          <div id="historyList" class="history"></div>
          <div class="hint">Guardado local (localStorage).</div>
        </div>
      </section>
    </main>
  </div>

  <!-- OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
